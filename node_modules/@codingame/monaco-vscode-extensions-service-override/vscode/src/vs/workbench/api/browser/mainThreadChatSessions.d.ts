import { CancellationToken } from "@codingame/monaco-vscode-api/vscode/vs/base/common/cancellation";
import { Event } from "@codingame/monaco-vscode-api/vscode/vs/base/common/event";
import { Disposable } from "@codingame/monaco-vscode-api/vscode/vs/base/common/lifecycle";
import { IObservable } from "@codingame/monaco-vscode-api/vscode/vs/base/common/observable";
import { URI, UriComponents } from "@codingame/monaco-vscode-api/vscode/vs/base/common/uri";
import { IDialogService } from "@codingame/monaco-vscode-api/vscode/vs/platform/dialogs/common/dialogs.service";
import { ILogService } from "@codingame/monaco-vscode-api/vscode/vs/platform/log/common/log.service";
import { IChatWidgetService } from "@codingame/monaco-vscode-api/vscode/vs/workbench/contrib/chat/browser/chat.service";
import { IChatAgentRequest } from "@codingame/monaco-vscode-api/vscode/vs/workbench/contrib/chat/common/participants/chatAgents";
import { IChatContentInlineReference, IChatProgress } from "@codingame/monaco-vscode-api/vscode/vs/workbench/contrib/chat/common/chatService/chatService";
import { IChatService } from "@codingame/monaco-vscode-api/vscode/vs/workbench/contrib/chat/common/chatService/chatService.service";
import { IChatSession, IChatSessionHistoryItem, IChatSessionProviderOptionItem } from "@codingame/monaco-vscode-api/vscode/vs/workbench/contrib/chat/common/chatSessionsService";
import { IChatSessionsService } from "@codingame/monaco-vscode-api/vscode/vs/workbench/contrib/chat/common/chatSessionsService.service";
import { IEditorGroupsService } from "@codingame/monaco-vscode-api/vscode/vs/workbench/services/editor/common/editorGroupsService.service";
import { IEditorService } from "@codingame/monaco-vscode-api/vscode/vs/workbench/services/editor/common/editorService.service";
import { IExtHostContext } from "../../services/extensions/common/extHostCustomers.js";
import { Dto } from "@codingame/monaco-vscode-api/vscode/vs/workbench/services/extensions/common/proxyIdentifier";
import { ExtHostChatSessionsShape, IChatProgressDto, MainThreadChatSessionsShape } from "@codingame/monaco-vscode-api/vscode/vs/workbench/api/common/extHost.protocol";
export declare class ObservableChatSession extends Disposable implements IChatSession {
    readonly sessionResource: URI;
    readonly providerHandle: number;
    readonly history: Array<IChatSessionHistoryItem>;
    private _options?;
    get options(): Record<string, string | IChatSessionProviderOptionItem> | undefined;
    private readonly _progressObservable;
    private readonly _isCompleteObservable;
    private readonly _onWillDispose;
    readonly onWillDispose: Event<void>;
    private readonly _pendingProgressChunks;
    private _isInitialized;
    private _interruptionWasCanceled;
    private _disposalPending;
    private _initializationPromise?;
    interruptActiveResponseCallback?: () => Promise<boolean>;
    requestHandler?: (request: IChatAgentRequest, progress: (progress: IChatProgress[]) => void, history: any[], token: CancellationToken) => Promise<void>;
    private readonly _proxy;
    private readonly _providerHandle;
    private readonly _logService;
    private readonly _dialogService;
    get progressObs(): IObservable<IChatProgress[]>;
    get isCompleteObs(): IObservable<boolean>;
    constructor(resource: URI, providerHandle: number, proxy: ExtHostChatSessionsShape, logService: ILogService, dialogService: IDialogService);
    initialize(token: CancellationToken): Promise<void>;
    private _doInitializeContent;
    /**
     * Handle progress chunks coming from the extension host.
     * If the session is not initialized yet, the chunks will be queued.
     */
    handleProgressChunk(requestId: string, progress: IChatProgress[]): void;
    /**
     * Handle progress completion from the extension host.
     */
    handleProgressComplete(requestId: string): void;
    private _addProgress;
    private _markComplete;
    dispose(): void;
}
export declare class MainThreadChatSessions extends Disposable implements MainThreadChatSessionsShape {
    private readonly _extHostContext;
    private readonly _chatSessionsService;
    private readonly _chatService;
    private readonly _chatWidgetService;
    private readonly _dialogService;
    private readonly _editorService;
    private readonly editorGroupService;
    private readonly _logService;
    private readonly _itemProvidersRegistrations;
    private readonly _contentProvidersRegistrations;
    private readonly _sessionTypeToHandle;
    private readonly _activeSessions;
    private readonly _sessionDisposables;
    private readonly _proxy;
    constructor(_extHostContext: IExtHostContext, _chatSessionsService: IChatSessionsService, _chatService: IChatService, _chatWidgetService: IChatWidgetService, _dialogService: IDialogService, _editorService: IEditorService, editorGroupService: IEditorGroupsService, _logService: ILogService);
    private _getHandleForSessionType;
    $registerChatSessionItemProvider(handle: number, chatSessionType: string): void;
    $onDidChangeChatSessionItems(handle: number): void;
    $onDidChangeChatSessionOptions(handle: number, sessionResourceComponents: UriComponents, updates: ReadonlyArray<{
        optionId: string;
        value: string;
    }>): void;
    $onDidCommitChatSessionItem(handle: number, originalComponents: UriComponents, modifiedCompoennts: UriComponents): Promise<void>;
    private _provideChatSessionItems;
    private handleSessionModelOverrides;
    private _provideChatSessionContent;
    $unregisterChatSessionItemProvider(handle: number): void;
    $registerChatSessionContentProvider(handle: number, chatSessionScheme: string): void;
    $unregisterChatSessionContentProvider(handle: number): void;
    $handleProgressChunk(handle: number, sessionResource: UriComponents, requestId: string, chunks: (IChatProgressDto | [
        IChatProgressDto,
        number
    ])[]): Promise<void>;
    $handleProgressComplete(handle: number, sessionResource: UriComponents, requestId: string): void;
    $handleAnchorResolve(handle: number, sesssionResource: UriComponents, requestId: string, requestHandle: string, anchor: Dto<IChatContentInlineReference>): void;
    $onDidChangeChatSessionProviderOptions(handle: number): void;
    private _refreshProviderOptions;
    dispose(): void;
    private _reviveTooltip;
    /**
     * Notify the extension about option changes for a session
     */
    notifyOptionsChange(handle: number, sessionResource: URI, updates: ReadonlyArray<{
        optionId: string;
        value: string | IChatSessionProviderOptionItem | undefined;
    }>): Promise<void>;
}
