
import { Disposable } from '../../../../../../base/common/lifecycle.js';
import '../../../../../../base/common/observableInternal/index.js';
import { ElicitationState } from '../../chatService/chatService.js';
import { observableValue } from '../../../../../../base/common/observableInternal/observables/observableValue.js';

class ChatElicitationRequestPart extends Disposable {
    constructor(title, message, subtitle, acceptButtonLabel, rejectButtonLabel,
    _accept, reject, source, moreActions, onHide) {
        super();
        this.title = title;
        this.message = message;
        this.subtitle = subtitle;
        this.acceptButtonLabel = acceptButtonLabel;
        this.rejectButtonLabel = rejectButtonLabel;
        this._accept = _accept;
        this.source = source;
        this.moreActions = moreActions;
        this.onHide = onHide;
        this.kind = 'elicitation2';
        this.state = observableValue('state', ElicitationState.Pending);
        this._isHiddenValue = observableValue('isHidden', false);
        this.isHidden = this._isHiddenValue;
        if (reject) {
            this.reject = async () => {
                const state = await reject();
                this.state.set(state, undefined);
            };
        }
    }
    accept(value) {
        return this._accept(value).then(state => {
            this.state.set(state, undefined);
        });
    }
    hide() {
        if (this._isHiddenValue.get()) {
            return;
        }
        this._isHiddenValue.set(true, undefined, undefined);
        this.onHide?.();
        this.dispose();
    }
    toJSON() {
        const state = this.state.get();
        return {
            kind: 'elicitationSerialized',
            title: this.title,
            message: this.message,
            state: state === ElicitationState.Pending ? ElicitationState.Rejected : state,
            acceptedResult: this.acceptedResult,
            subtitle: this.subtitle,
            source: this.source,
            isHidden: this._isHiddenValue.get(),
        };
    }
}

export { ChatElicitationRequestPart };
